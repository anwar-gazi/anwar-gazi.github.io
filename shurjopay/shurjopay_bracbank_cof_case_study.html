<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BRAC Bank Encryption Compatibility – ShurjoPay Case Study</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../footer.css" />
  <script src="../footer.js" defer></script>
  <style>
    :root {
      --bg: #020617;
      --bg-alt: #02081a;
      --card: #020617;
      --accent: #22c55e;
      --accent-2: #0ea5e9;
      --accent-soft: rgba(14, 165, 233, 0.16);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2937;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 18px 50px rgba(15, 23, 42, 0.95);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, #082f49 0, transparent 55%),
        radial-gradient(circle at bottom right, #020617 0, #000000 60%);
      color: var(--text-main);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    a { color: #7dd3fc; text-decoration: none; }
    a:hover { text-decoration: underline; }

    header {
      position: sticky;
      top: 0;
      z-index: 30;
      backdrop-filter: blur(14px);
      background: linear-gradient(
        to bottom,
        rgba(2, 6, 23, 0.98),
        rgba(8, 47, 73, 0.9),
        transparent
      );
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }
    .header-inner {
      max-width: 980px;
      margin: 0 auto;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .brand { display: flex; align-items: center; gap: 10px; }
    .brand-badge {
      width: 34px; height: 34px; border-radius: 999px;
      background: conic-gradient(from 210deg, #22c55e, #0ea5e9, #22c55e);
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; color: #020617;
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.75);
      font-size: 17px;
    }
    .brand-text-main { font-weight: 600; font-size: 15px; letter-spacing: 0.04em; }
    .brand-text-sub { font-size: 11px; color: var(--text-muted); text-transform: uppercase; }

    .header-actions { display: flex; gap: 10px; align-items: center; }
    .pill {
      font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em;
      color: var(--text-muted);
      padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background-color: rgba(15, 23, 42, 0.75);
    }
    .btn-primary {
      border: none; outline: none; cursor: pointer;
      padding: 8px 16px; border-radius: 999px;
      font-size: 13px; font-weight: 600; letter-spacing: 0.03em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #22c55e, #0ea5e9);
      color: #020617;
      display: inline-flex; align-items: center; gap: 8px;
      box-shadow: 0 12px 30px rgba(8, 47, 73, 0.9);
      transition: transform 0.13s ease, box-shadow 0.13s ease, background 0.13s ease;
    }
    .btn-primary span { font-size: 16px; }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 18px 45px rgba(8, 47, 73, 1); }
    .btn-primary:active { transform: translateY(1px) scale(0.99); box-shadow: 0 8px 20px rgba(8, 47, 73, 0.8); }

    main { max-width: 980px; margin: 0 auto; padding: 26px 18px 48px; }

    .hero {
      margin-top: 10px; margin-bottom: 32px;
      padding: 22px 22px 20px;
      border-radius: 24px;
      background:
        radial-gradient(circle at top left, rgba(14, 165, 233, 0.25), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34, 197, 94, 0.25), transparent 60%),
        linear-gradient(145deg, rgba(2, 6, 23, 0.97), rgba(3, 7, 18, 1));
      border: 1px solid rgba(148, 163, 184, 0.38);
      box-shadow: var(--shadow-soft);
      display: grid;
      grid-template-columns: minmax(0, 2.4fr) minmax(0, 1.6fr);
      gap: 22px; align-items: center;
    }
    @media (max-width: 780px) {
      .hero { grid-template-columns: minmax(0, 1fr); padding: 20px 18px 18px; }
    }
    .hero-title {
      font-size: clamp(26px, 3.2vw, 30px);
      line-height: 1.2;
      margin-bottom: 10px;
      font-weight: 650;
      letter-spacing: 0.02em;
    }
    .hero-subtitle { font-size: 14px; color: var(--text-muted); margin-bottom: 10px; }
    .hero-tagline {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 5px 10px;
      border-radius: 999px;
      background-color: rgba(15, 118, 110, 0.4);
      color: #d1fae5;
      border: 1px solid rgba(45, 212, 191, 0.8);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      margin-bottom: 12px;
    }
    .hero-meta { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; }
    .hero-meta-item {
      padding: 6px 10px;
      border-radius: 999px;
      background-color: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 11px;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .hero-meta-item strong { color: #e5e7eb; font-weight: 500; }
    .hero-summary { font-size: 14px; color: var(--text-main); margin-top: 6px; }

    .hero-side {
      padding: 12px 14px 10px;
      border-radius: 18px;
      background:
        radial-gradient(circle at top right, rgba(248, 250, 252, 0.1), transparent 60%),
        linear-gradient(135deg, #020617, #020617);
      border: 1px solid rgba(148, 163, 184, 0.45);
    }
    .hero-side-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 6px;
    }
    .metric-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; margin-bottom: 10px; }
    .metric-card {
      border-radius: 14px;
      padding: 10px 11px;
      background-color: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }
    .metric-label { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; }
    .metric-value { font-size: 17px; font-weight: 600; margin-bottom: 4px; color: #f9fafb; }
    .metric-footnote { font-size: 10px; color: var(--text-muted); }

    .stack-list { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .stack-pill {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-muted);
      background-color: rgba(15, 23, 42, 0.85);
    }

    .layout { display: grid; grid-template-columns: minmax(0, 3fr) minmax(0, 1.55fr); gap: 24px; }
    @media (max-width: 920px) { .layout { grid-template-columns: minmax(0, 1fr); } }

    .section-card {
      background-color: rgba(15, 23, 42, 0.98);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: 18px 18px 14px;
      margin-bottom: 18px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.9);
    }

    h2 { margin-top: 0; font-size: 19px; margin-bottom: 6px; }
    h3 { font-size: 15px; margin-bottom: 4px; margin-top: 12px; }
    .eyebrow { font-size: 11px; text-transform: uppercase; letter-spacing: 0.12em; color: var(--text-muted); margin-bottom: 2px; }
    p { margin: 4px 0; font-size: 14px; color: #e5e7eb; }
    ul { padding-left: 18px; margin: 4px 0 6px; }
    li { font-size: 14px; margin-bottom: 3px; color: #e5e7eb; }

    .callout {
      border-radius: var(--radius-md);
      background-color: var(--accent-soft);
      padding: 10px 11px;
      border-left: 3px solid var(--accent-2);
      margin-top: 6px;
      font-size: 13px;
      color: #e5e7eb;
    }

    .timeline { border-left: 1px dashed rgba(148, 163, 184, 0.5); margin-top: 6px; padding-left: 14px; }
    .timeline-item { margin-bottom: 8px; position: relative; padding-left: 4px; }
    .timeline-item::before {
      content: "";
      position: absolute;
      left: -15px;
      top: 6px;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #bbf7d0, #22c55e);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
    }
    .timeline-title { font-size: 13px; font-weight: 500; margin-bottom: 2px; }
    .timeline-body { font-size: 13px; color: var(--text-muted); }

    .side-section-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin-bottom: 6px;
    }
    .side-chip {
      font-size: 12px;
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      margin-bottom: 4px;
      display: inline-block;
      color: var(--text-muted);
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(15, 23, 42, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }
    .modal-backdrop.active { display: flex; }
    .modal {
      max-width: 720px;
      width: 100%;
      margin: 16px;
      border-radius: 20px;
      background:
        radial-gradient(circle at top left, rgba(34, 197, 94, 0.22), transparent 60%),
        #020617;
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: 0 20px 55px rgba(15, 23, 42, 1);
      padding: 18px 18px 16px;
    }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; gap: 12px; }
    .modal-title { font-size: 16px; font-weight: 600; }
    .modal-subtitle { font-size: 12px; color: var(--text-muted); }
    .btn-icon {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      width: 26px;
      height: 26px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
      cursor: pointer;
      font-size: 16px;
    }
    .btn-icon:hover { background-color: rgba(15, 23, 42, 1); }
    .modal-body { font-size: 13px; max-height: 70vh; overflow-y: auto; padding-right: 4px; }
    .summary-grid { display: grid; grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr); gap: 14px; margin-bottom: 8px; }
    @media (max-width: 680px) { .summary-grid { grid-template-columns: minmax(0, 1fr); } }
    .summary-section-title { font-size: 12px; text-transform: uppercase; letter-spacing: 0.12em; color: var(--text-muted); margin-bottom: 4px; }
    .summary-list { padding-left: 16px; margin: 2px 0 4px; }
    .summary-list li { font-size: 13px; margin-bottom: 3px; }

    footer {
      margin-top: 24px;
      font-size: 12px;
      color: var(--text-muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="brand-badge">SP</div>
        <div>
          <div class="brand-text-main">Payments Reliability &amp; Card-on-File Enablement</div>
          <div class="brand-text-sub">ShurjoPay × BRAC Bank Integration Case Study</div>
        </div>
      </div>
      <div class="header-actions">
        <div class="pill">Fintech • 2022</div>
        <button class="btn-primary" id="openSummaryBtn">
          <span>☰</span> One-Page Summary
        </button>
      </div>
    </div>
  </header>

  <main>
    <section class="hero" aria-labelledby="hero-title">
      <div>
        <div class="hero-tagline">
          <span>●</span> Fintech • Encryption Compatibility • Card-on-File (CoF)
        </div>
        <h1 id="hero-title" class="hero-title">
          Fixing BRAC Bank Token Encryption in PHP 8 — and Re-enabling Card-on-File
        </h1>
        <p class="hero-subtitle">
          Resolved BRAC Bank transaction failures caused by a PHP 7 bank-provided encryption library running inside a PHP 8 system.
          Eliminated the PHP 7 subdomain workaround by aligning the salt mechanism, restored correct token generation in PHP 8, and
          unlocked Card-on-File as a product milestone.
        </p>

        <div class="hero-meta">
          <div class="hero-meta-item"><strong>Role</strong> Senior Software Engineer</div>
          <div class="hero-meta-item"><strong>Org</strong> ShurjoPay Ltd. (Payment Gateway), Dhaka</div>
          <div class="hero-meta-item"><strong>Scope</strong> Payment token encryption, gateway integration, CoF</div>
        </div>

        <p class="hero-summary">
          A subset of payments (BRAC Bank cards/accounts) failed because the bank’s PHP 7 wire-transfer/token library produced
          incompatible encryption output when required from PHP 8. The “keep it working” workaround added a PHP 7 REST endpoint on a
          separate subdomain — which, in turn, blocked ShurjoPay’s Card-on-File flow. I took ownership, identified the salt mismatch,
          made the encryption deterministic in PHP 8, removed the subdomain dependency, and restored both reliability and product capability.
        </p>
      </div>

      <aside class="hero-side" aria-label="Snapshot">
        <div class="hero-side-label">Snapshot</div>
        <div class="metric-grid">
          <div class="metric-card">
            <div class="metric-label">Outcome</div>
            <div class="metric-value">BRAC Payments Restored</div>
            <div class="metric-footnote">Correct encryption/token generation under PHP 8.</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Product Milestone</div>
            <div class="metric-value">CoF Enabled</div>
            <div class="metric-footnote">Card-on-File available after long downtime.</div>
          </div>
        </div>

        <div class="metric-card" style="margin-top:8px;">
          <div class="metric-label">Architecture Improvement</div>
          <div class="metric-footnote">
            • Removed PHP 7 subdomain dependency.<br />
            • Unified payment flow in one runtime and one domain.<br />
            • Reduced operational &amp; security surface area.
          </div>
        </div>

        <div style="margin-top:10px;">
          <div class="hero-side-label">Core Stack</div>
          <div class="stack-list">
            <span class="stack-pill">PHP 8</span>
            <span class="stack-pill">Laravel</span>
            <span class="stack-pill">MySQL</span>
            <span class="stack-pill">OpenSSL</span>
            <span class="stack-pill">REST APIs</span>
            <span class="stack-pill">Card-on-File</span>
          </div>
        </div>
      </aside>
    </section>

    <section class="layout" aria-label="Case study content layout">
      <div>
        <article class="section-card" id="overview">
          <div class="eyebrow">Overview</div>
          <h2>What Happened</h2>
          <p>
            ShurjoPay’s BRAC Bank integration depended on a bank-provided library (from BRAC Bank’s IT team) that generated an encrypted
            token required for transaction requests. The library was authored for <strong>PHP 7</strong>, while ShurjoPay’s main system
            ran on <strong>PHP 8</strong>. When we <code>require</code>-ed the library directly in the PHP 8 runtime, the encrypted token
            was produced incorrectly, and BRAC Bank transactions failed.
          </p>
          <p>
            A prior team mitigated the incident by creating a small <strong>PHP 7 REST endpoint</strong> (hosted on a subdomain) that
            wrapped the bank library and returned the encrypted token to the main app. This restored payment success — but introduced a
            domain boundary that blocked the <strong>Card-on-File (CoF)</strong> confirmation workflow. As a result, CoF remained disabled
            for a long time.
          </p>
        </article>

        <article class="section-card" id="context">
          <div class="eyebrow">Context</div>
          <h2>Why This Was High-Stakes</h2>
          <ul>
            <li><strong>Reliability:</strong> issuer-specific failures erode trust quickly (users perceive the gateway as unstable).</li>
            <li><strong>Security &amp; compliance:</strong> token/encryption steps must remain correct, deterministic, and auditable.</li>
            <li><strong>Product growth:</strong> Card-on-File is a conversion and convenience driver for repeat payments.</li>
            <li><strong>Operational burden:</strong> a “side-service” adds extra deployment, monitoring, and incident surface area.</li>
          </ul>
          <div class="callout">
            In payments, the integration layer is part of the product. If token-generation is brittle, both revenue and reputation suffer.
          </div>
        </article>

        <article class="section-card" id="problem">
          <div class="eyebrow">Challenge</div>
          <h2>Problem Statement</h2>
          <ul>
            <li>BRAC Bank transaction requests were rejected because tokens were not encrypted appropriately under PHP 8.</li>
            <li>The workaround PHP 7 token service required a subdomain, which restricted Card-on-File saving after user confirmation.</li>
            <li>CoF was unavailable for a long time, creating a persistent feature gap and merchant/user friction.</li>
          </ul>
        </article>

        <article class="section-card" id="investigation">
          <div class="eyebrow">Investigation</div>
          <h2>Root Cause</h2>
          <p>
            After taking charge, I reproduced the token-generation flow in controlled environments and compared outputs across runtimes.
            The core issue was not only “PHP 7 vs PHP 8” — the failure came from a <strong>salt mechanism mismatch</strong> that changed the
            derived/encrypted output when executed in our PHP 8 environment.
          </p>
          <ul>
            <li>Validated token parity (same inputs must yield bank-accepted outputs).</li>
            <li>Isolated where the encrypted output diverged.</li>
            <li>Confirmed the divergence originated in the salt-handling step affecting the final encrypted token.</li>
          </ul>
        </article>

        <article class="section-card" id="solution">
          <div class="eyebrow">Solution</div>
          <h2>What I Implemented</h2>

          <h3>1) Align the salt mechanism for PHP 8 execution</h3>
          <ul>
            <li>Updated integration logic so salt generation/handling matched the bank library’s expectations.</li>
            <li>Ensured the encryption output became deterministic and valid when the bank library is used from PHP 8.</li>
          </ul>

          <h3>2) Remove the PHP 7 subdomain dependency</h3>
          <ul>
            <li>Eliminated the need for the separate PHP 7 REST endpoint that wrapped the bank library.</li>
            <li>Unified the BRAC token-generation inside the primary app runtime and domain.</li>
          </ul>

          <h3>3) Restore Card-on-File end-to-end flow</h3>
          <ul>
            <li>Re-enabled card saving on user confirmation (CoF) without cross-domain limitations.</li>
            <li>Stabilized the confirmation → token persistence pathway as a first-class feature.</li>
          </ul>

          <div class="callout">
            This was a “fix the root, not the workaround” change: remove runtime drift and unblock a major product capability.
          </div>
        </article>

        <article class="section-card" id="reliability">
          <div class="eyebrow">Reliability</div>
          <h2>How It Improved Reliability</h2>
          <ul>
            <li><strong>Higher success rate for BRAC Bank flows</strong> by generating bank-accepted encrypted tokens under PHP 8.</li>
            <li><strong>Fewer moving parts</strong> by removing a network hop and a separately deployed subdomain service.</li>
            <li><strong>Lower latency &amp; variance</strong> by avoiding extra HTTP calls and reducing external dependency failure modes.</li>
            <li><strong>Faster debugging</strong> with a single runtime path and consistent logs/traceability.</li>
          </ul>
        </article>

        <article class="section-card" id="security">
          <div class="eyebrow">Security</div>
          <h2>How It Improved Security</h2>
          <ul>
            <li><strong>Reduced attack surface</strong> by removing a publicly reachable PHP 7 token sub-service.</li>
            <li><strong>Improved workflow integrity</strong> for Card-on-File by keeping confirmation and token handling within one domain.</li>
            <li><strong>Lower config/secret sprawl</strong> by avoiding duplicated credentials/configs across services.</li>
            <li><strong>More consistent controls</strong> (auth, rate limiting, logging hygiene) by consolidating into the primary platform boundary.</li>
          </ul>
          <p style="font-size:13px;color:var(--text-muted);margin-top:8px;">
            Note: This change focused on correctness and operational security posture. It did not alter the bank’s algorithm choice; it made the integration deterministic and safer to run at scale.
          </p>
        </article>

        <article class="section-card" id="validation">
          <div class="eyebrow">Verification</div>
          <h2>Validation Approach</h2>
          <ul>
            <li><strong>Parity checks:</strong> confirm PHP 8 output matches bank-accepted token generation.</li>
            <li><strong>Regression testing:</strong> BRAC flows succeed without affecting other issuers.</li>
            <li><strong>CoF scenarios:</strong> confirm card save after user consent; confirm repeat payments using stored tokens.</li>
            <li><strong>Operational monitoring:</strong> track issuer-specific errors and ensure sustained stability.</li>
          </ul>
        </article>

        <article class="section-card" id="takeaways">
          <div class="eyebrow">Reflection</div>
          <h2>Key Takeaways</h2>
          <ul>
            <li>Runtime compatibility problems are often symptoms; the real root can be subtle (salt/derivation differences).</li>
            <li>Workarounds keep the lights on — but can silently block core product capabilities (like Card-on-File).</li>
            <li>Consolidating critical payment flows reduces both operational risk and security exposure.</li>
          </ul>
        </article>
      </div>

      <aside aria-label="Sidebar information">
        <section class="section-card">
          <div class="side-section-title">My Role</div>
          <ul>
            <li>Owned investigation across runtimes (PHP 7 vs PHP 8) and integration behavior.</li>
            <li>Identified salt mechanism mismatch affecting encryption output.</li>
            <li>Implemented the PHP 8-compatible fix and removed the PHP 7 subdomain dependency.</li>
            <li>Re-enabled Card-on-File with correct confirmation &amp; persistence flow.</li>
          </ul>
        </section>

        <section class="section-card">
          <div class="side-section-title">Architecture Snapshot</div>
          <ul>
            <li><strong>Primary app:</strong> PHP 8 + Laravel, MySQL-backed transaction system.</li>
            <li><strong>Integration:</strong> BRAC Bank token/encryption library (bank-supplied).</li>
            <li><strong>Before:</strong> PHP 7 wrapper REST endpoint on a subdomain.</li>
            <li><strong>After:</strong> Token generated inside the main runtime and domain.</li>
          </ul>
          <div class="callout" style="margin-top:10px;">
            Removing the wrapper endpoint eliminated cross-domain constraints that blocked Card-on-File.
          </div>
        </section>

        <section class="section-card">
          <div class="side-section-title">Timeline</div>
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-title">Initial state: PHP 7 library in a PHP 8 system</div>
              <div class="timeline-body">BRAC token encryption incorrect → issuer-specific payment failures.</div>
            </div>
            <div class="timeline-item">
              <div class="timeline-title">Interim workaround</div>
              <div class="timeline-body">PHP 7 token micro-endpoint on subdomain restored payments but blocked CoF.</div>
            </div>
            <div class="timeline-item">
              <div class="timeline-title">My fix</div>
              <div class="timeline-body">Salt mechanism aligned → PHP 8 direct use → CoF enabled as a milestone.</div>
            </div>
          </div>
        </section>

        <section class="section-card">
          <div class="side-section-title">Keywords &amp; Themes</div>
          <p>Useful tags for CVs, portfolios, and search:</p>
          <div>
            <span class="side-chip">Fintech</span>
            <span class="side-chip">Payment Gateway</span>
            <span class="side-chip">Issuer Integration</span>
            <span class="side-chip">Encryption Token</span>
            <span class="side-chip">PHP 8 Migration</span>
            <span class="side-chip">Card-on-File</span>
            <span class="side-chip">Reliability</span>
            <span class="side-chip">Security Posture</span>
          </div>
        </section>
      </aside>
    </section>

    <footer>
      Making payments boringly reliable — and removing “temporary” workarounds that block product growth.
    </footer>
  </main>

  <div class="modal-backdrop" id="summaryModal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modal-header">
        <div>
          <div class="modal-title">ShurjoPay × BRAC Bank – One-Page Summary</div>
          <div class="modal-subtitle">Quick snapshot of the encryption compatibility and Card-on-File enablement work.</div>
        </div>
        <button class="btn-icon" id="closeSummaryBtn" aria-label="Close summary modal">×</button>
      </div>
      <div class="modal-body">
        <div class="summary-grid">
          <div>
            <div class="summary-section-title">Context</div>
            <ul class="summary-list">
              <li>Bank-supplied token/encryption library built for PHP 7.</li>
              <li>ShurjoPay platform runtime upgraded to PHP 8.</li>
              <li>BRAC Bank flows required strict token correctness.</li>
            </ul>

            <div class="summary-section-title">Challenge</div>
            <ul class="summary-list">
              <li>Incorrect encryption output in PHP 8 → BRAC Bank transaction failures.</li>
              <li>Existing PHP 7 subdomain workaround restored payments but blocked Card-on-File.</li>
            </ul>
          </div>

          <div>
            <div class="summary-section-title">My Role</div>
            <ul class="summary-list">
              <li>Investigated runtime differences and token-generation divergence.</li>
              <li>Identified salt mechanism mismatch as the root cause.</li>
              <li>Implemented PHP 8-compatible fix and removed subdomain dependency.</li>
            </ul>

            <div class="summary-section-title">Approach</div>
            <ul class="summary-list">
              <li>Parity testing across PHP 7/8 outputs.</li>
              <li>Salt alignment for deterministic, bank-accepted tokens.</li>
              <li>End-to-end CoF validation after consolidation.</li>
            </ul>
          </div>
        </div>

        <div class="summary-section-title">Outcomes</div>
        <ul class="summary-list">
          <li>BRAC Bank payments stabilized with correct encryption in PHP 8.</li>
          <li>Removed PHP 7 token microservice and reduced operational/security surface.</li>
          <li>Card-on-File re-enabled as a major product milestone.</li>
        </ul>

        <div class="summary-section-title">Key Takeaways</div>
        <ul class="summary-list">
          <li>Workarounds can block product growth; fix the root cause when possible.</li>
          <li>Deterministic token generation is non-negotiable in payment integrations.</li>
          <li>Consolidation improves reliability, security posture, and developer velocity.</li>
        </ul>
      </div>
    </div>
  </div>

  <app-footer></app-footer>

  <script>
    (function () {
      const modal = document.getElementById("summaryModal");
      const openBtn = document.getElementById("openSummaryBtn");
      const closeBtn = document.getElementById("closeSummaryBtn");

      function openModal() {
        modal.classList.add("active");
        modal.setAttribute("aria-hidden", "false");
      }

      function closeModal() {
        modal.classList.remove("active");
        modal.setAttribute("aria-hidden", "true");
      }

      openBtn.addEventListener("click", openModal);
      closeBtn.addEventListener("click", closeModal);

      modal.addEventListener("click", function (e) {
        if (e.target === modal) closeModal();
      });

      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") closeModal();
      });
    })();
  </script>
</body>
</html>
